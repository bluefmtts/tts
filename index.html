<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueFM TTS - World's Most Affordable AI Voice Platform</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="BlueFM TTS - 2025's most affordable text-to-speech service. Convert up to 50 lakh characters monthly with personal AI bot.">
    <meta name="keywords" content="TTS, Text to Speech, AI Voice, BlueFM, Affordable TTS">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase v9 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #3b82f6;
            --accent: #60a5fa;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-screen.hide {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auth Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem;
        }

        .auth-box {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            padding: 2.5rem;
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo h1 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .auth-logo p {
            color: var(--gray);
            margin-top: 0.5rem;
        }

        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-input.error {
            border-color: var(--error);
        }

        .form-error {
            color: var(--error);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .password-toggle {
            position: relative;
        }

        .password-toggle-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.25rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
            font-size: 1rem;
            padding: 1rem;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .divider {
            text-align: center;
            margin: 2rem 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border);
        }

        .divider span {
            background: white;
            padding: 0 1rem;
            position: relative;
            color: var(--gray);
            font-size: 0.875rem;
        }

        .social-login {
            display: flex;
            gap: 1rem;
        }

        .btn-social {
            flex: 1;
            background: white;
            border: 2px solid var(--border);
            color: var(--dark);
        }

        .btn-social:hover {
            background: var(--light);
            border-color: var(--primary);
        }

        .auth-footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--gray);
            font-size: 0.875rem;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* Main App Container */
        .app-container {
            display: none;
            min-height: 100vh;
            background: var(--light);
        }

        /* Header */
        header {
            background: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 240px;
            display: none;
            overflow: hidden;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-email {
            font-weight: 600;
            color: var(--dark);
        }

        .dropdown-plan {
            font-size: 0.875rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }

        .dropdown-menu {
            padding: 0.5rem;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .dropdown-item:hover {
            background: var(--light);
            color: var(--primary);
        }

        .dropdown-item.danger {
            color: var(--error);
        }

        /* Info Page */
        .info-page {
            display: none;
            padding: 4rem 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 4rem;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--gray);
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .hero-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 1rem;
        }

        .feature-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .feature-desc {
            color: var(--gray);
            line-height: 1.6;
        }

        .stats-section {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 4rem;
            box-shadow: var(--shadow);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            text-align: center;
        }

        .stat-item {
            padding: 1rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray);
            font-weight: 500;
        }

        /* Pricing Section */
        .pricing-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 4rem 3rem;
            margin-bottom: 4rem;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .pricing-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        .pricing-badge {
            display: inline-block;
            background: var(--warning);
            color: var(--dark);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
        }

        .pricing-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            position: relative;
        }

        .pricing-subtitle {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: 3rem;
            position: relative;
        }

        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .price-card {
            background: white;
            color: var(--dark);
            border-radius: 16px;
            padding: 2.5rem 2rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .price-card.popular {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .popular-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--error);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .price-header {
            margin-bottom: 2rem;
        }

        .price-plan {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .price-amount {
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .price-currency {
            font-size: 1.5rem;
            color: var(--gray);
        }

        .price-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
        }

        .price-period {
            color: var(--gray);
        }

        .price-original {
            text-decoration: line-through;
            color: var(--gray);
            font-size: 1.25rem;
        }

        .price-features {
            list-style: none;
            margin: 2rem 0;
        }

        .price-features li {
            padding: 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .price-features i {
            color: var(--success);
        }

        .btn-upgrade {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .btn-upgrade:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        /* Waiting Section */
        .waiting-section {
            display: none;
            max-width: 600px;
            margin: 4rem auto;
            text-align: center;
            padding: 0 1.5rem;
        }

        .waiting-card {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: var(--shadow-lg);
        }

        .waiting-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .waiting-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .waiting-desc {
            color: var(--gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .countdown-timer {
            background: var(--light);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .countdown-label {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .countdown-item {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            min-width: 80px;
        }

        .countdown-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
        }

        .countdown-unit {
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
        }

        .email-verify-form {
            margin-top: 2rem;
            display: none;
        }

        .email-verify-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        /* TTS Page */
        .tts-page {
            display: none;
            padding: 2rem 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tts-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .tts-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .tts-subtitle {
            color: var(--gray);
            font-size: 1.125rem;
        }

        /* Voice Selection */
        .voice-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .voice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .voice-card {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .voice-card:hover {
            border-color: var(--primary);
            background: var(--light);
        }

        .voice-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .voice-radio {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .voice-card.selected .voice-radio {
            border-color: var(--primary);
            background: var(--primary);
        }

        .voice-card.selected .voice-radio::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .voice-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .voice-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .voice-desc {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .voice-demo-btn {
            width: 100%;
            padding: 0.5rem;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-demo-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--light);
        }

        .upload-area.drag-over {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .upload-text {
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .file-info {
            display: none;
            background: var(--light);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            align-items: center;
            justify-content: space-between;
        }

        .file-info.show {
            display: flex;
        }

        .file-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-name {
            font-weight: 500;
        }

        .file-size {
            font-size: 0.875rem;
            color: var(--gray);
        }

        .remove-file-btn {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            padding: 0.5rem;
        }

        /* Character Info */
        .char-info {
            background: var(--light);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .char-info.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .char-count {
            font-weight: 500;
        }

        .char-limit {
            font-size: 0.875rem;
            color: var(--gray);
        }

        .char-warning {
            color: var(--warning);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .char-warning.show {
            display: block;
        }

        /* Generate Button */
        .generate-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .generate-info {
            color: white;
            margin-bottom: 1.5rem;
        }

        .btn-generate {
            background: white;
            color: var(--primary);
            font-size: 1.125rem;
            padding: 1rem 3rem;
        }

        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255,255,255,0.3);
        }

        /* Processing Section */
        .processing-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .processing-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 2rem;
            animation: spin 2s linear infinite;
        }

        .processing-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .processing-desc {
            color: var(--gray);
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: var(--light);
            border-radius: 50px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .status-list {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            color: var(--gray);
        }

        .status-item.active {
            color: var(--warning);
        }

        .status-item.completed {
            color: var(--success);
        }

        .status-item i {
            font-size: 1.25rem;
        }

        /* Download Section */
        .download-section {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .download-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 2rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .download-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--success);
        }

        .download-desc {
            color: var(--gray);
            margin-bottom: 2rem;
        }

        .download-info {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .download-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .download-label {
            color: var(--gray);
        }

        .download-value {
            font-weight: 600;
        }

        .btn-download {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            font-size: 1.125rem;
            padding: 1rem 3rem;
            margin-bottom: 1rem;
        }

        /* History Page */
        .history-page {
            display: none;
            padding: 2rem 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .history-header {
            margin-bottom: 2rem;
        }

        .history-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .history-subtitle {
            color: var(--gray);
        }

        .history-filters {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .filter-select {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }

        .history-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .history-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .history-item:hover {
            background: var(--light);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-filename {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .history-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--gray);
        }

        .history-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .history-status.completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .history-status.processing {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .history-status.failed {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .history-actions {
            display: flex;
            gap: 0.5rem;
        }

        .history-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .history-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            font-size: 4rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .empty-desc {
            color: var(--gray);
            margin-bottom: 2rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--error);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 0.25rem;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 999;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .mobile-menu.show {
            transform: translateX(0);
        }

        .mobile-menu-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .mobile-menu-nav {
            padding: 1rem;
        }

        .mobile-menu-link {
            display: block;
            padding: 1rem;
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .mobile-menu-link:hover {
            background: var(--light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .header-nav {
                display: none;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.125rem;
            }

            .features-grid,
            .pricing-cards {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .voice-grid {
                grid-template-columns: 1fr;
            }

            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .history-actions {
                width: 100%;
            }

            .history-btn {
                flex: 1;
            }

            .toast-container {
                bottom: 1rem;
                right: 1rem;
                left: 1rem;
            }

            .toast {
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .auth-box {
                padding: 2rem 1.5rem;
            }

            .hero-title {
                font-size: 2rem;
            }

            .countdown-display {
                flex-wrap: wrap;
            }

            .countdown-item {
                min-width: 70px;
                padding: 0.75rem;
            }

            .countdown-value {
                font-size: 1.5rem;
            }
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
    </div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">
                <h1>
                    <i class="fas fa-microphone-alt"></i>
                    BlueFM TTS
                </h1>
                <p>2025's Most Affordable Text-to-Speech</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
                <button class="auth-tab" onclick="switchTab('register')">Create Account</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        class="form-input" 
                        placeholder="your@email.com"
                        required
                    >
                    <div class="form-error">Please enter a valid email</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-toggle">
                        <input 
                            type="password" 
                            id="loginPassword" 
                            class="form-input" 
                            placeholder="Enter your password"
                            required
                        >
                        <button type="button" class="password-toggle-btn" onclick="togglePassword('loginPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="form-error">Password is required</div>
                </div>

                <button type="submit" class="btn btn-primary" id="loginBtn">
                    Sign In
                </button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input 
                        type="text" 
                        id="registerName" 
                        class="form-input" 
                        placeholder="John Doe"
                        required
                    >
                    <div class="form-error">Please enter your name</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input 
                        type="email" 
                        id="registerEmail" 
                        class="form-input" 
                        placeholder="your@email.com"
                        required
                    >
                    <div class="form-error">Please enter a valid email</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="password-toggle">
                        <input 
                            type="password" 
                            id="registerPassword" 
                            class="form-input" 
                            placeholder="Create a strong password"
                            required
                            minlength="6"
                        >
                        <button type="button" class="password-toggle-btn" onclick="togglePassword('registerPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="form-error">Password must be at least 6 characters</div>
                </div>

                <button type="submit" class="btn btn-primary" id="registerBtn">
                    Create Account
                </button>
            </form>

            <div class="divider">
                <span>OR</span>
            </div>

            <div class="social-login">
                <button class="btn btn-social" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i>
                    Google
                </button>
                <button class="btn btn-social" onclick="showToast('Facebook login coming soon!', 'warning')">
                    <i class="fab fa-facebook"></i>
                    Facebook
                </button>
            </div>

            <div class="auth-footer">
                By signing up, you agree to our 
                <a href="#">Terms of Service</a> and 
                <a href="#">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header>
            <div class="header-content">
                <a href="#" class="logo" onclick="showPage('info')">
                    <i class="fas fa-microphone-alt"></i>
                    BlueFM TTS
                </a>

                <nav class="header-nav">
                    <a href="#" class="nav-link" onclick="showPage('info')">Home</a>
                    <a href="#" class="nav-link" onclick="showPage('tts')">Create Audio</a>
                    <a href="#" class="nav-link" onclick="showPage('history')">History</a>
                    
                    <div class="user-menu">
                        <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">
                            U
                        </div>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-email" id="userEmail">user@email.com</div>
                                <div class="dropdown-plan" id="userPlan">Free Plan</div>
                            </div>
                            <div class="dropdown-menu">
                                <button class="dropdown-item" onclick="showPage('profile')">
                                    <i class="fas fa-user"></i>
                                    Profile
                                </button>
                                <button class="dropdown-item" onclick="showPage('settings')">
                                    <i class="fas fa-cog"></i>
                                    Settings
                                </button>
                                <button class="dropdown-item" onclick="showPage('billing')">
                                    <i class="fas fa-credit-card"></i>
                                    Billing
                                </button>
                                <button class="dropdown-item danger" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </nav>

                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <div class="logo">
                    <i class="fas fa-microphone-alt"></i>
                    BlueFM TTS
                </div>
                <button class="mobile-menu-close" onclick="toggleMobileMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="mobile-menu-nav">
                <a href="#" class="mobile-menu-link" onclick="showPage('info')">Home</a>
                <a href="#" class="mobile-menu-link" onclick="showPage('tts')">Create Audio</a>
                <a href="#" class="mobile-menu-link" onclick="showPage('history')">History</a>
                <a href="#" class="mobile-menu-link" onclick="showPage('profile')">Profile</a>
                <a href="#" class="mobile-menu-link" onclick="showPage('settings')">Settings</a>
                <a href="#" class="mobile-menu-link" onclick="showPage('billing')">Billing</a>
                <a href="#" class="mobile-menu-link" onclick="logout()">Logout</a>
            </nav>
        </div>

        <!-- Info Page -->
        <div class="info-page" id="infoPage">
            <section class="hero-section">
                <div class="hero-badge">ðŸš€ 2025's Most Affordable TTS Service</div>
                <h1 class="hero-title">Transform Text to Natural Speech</h1>
                <p class="hero-subtitle">Create professional voiceovers with AI-powered voices</p>
            </section>

            <section class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <h3 class="feature-title">4 Premium Voices</h3>
                    <p class="feature-desc">Choose from professional male, friendly female, news anchor, and storyteller voices</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3 class="feature-title">20 Hours Weekly</h3>
                    <p class="feature-desc">Convert up to 20 hours of audio every week - that's 80 hours monthly!</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3 class="feature-title">50 Lakh Characters</h3>
                    <p class="feature-desc">Process up to 50 lakh characters per month with your personal bot</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 class="feature-title">Personal TTS Bot</h3>
                    <p class="feature-desc">Get your own Telegram bot for seamless text-to-speech conversion</p>
                </div>
            </section>

            <section class="stats-section">
                <h2 class="text-center mb-3">Why Choose BlueFM TTS?</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">3 Hours</div>
                        <div class="stat-label">Max audio per conversion</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">2 Lakh</div>
                        <div class="stat-label">Characters per file</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">6-12 Hours</div>
                        <div class="stat-label">Delivery time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">â‚¹99</div>
                        <div class="stat-label">Starting price</div>
                    </div>
                </div>
            </section>

            <section class="pricing-section">
                <div class="pricing-badge">LIMITED TIME OFFER</div>
                <h2 class="pricing-title">Choose Your Plan</h2>
                <p class="pricing-subtitle">Get instant access to premium features</p>

                <div class="pricing-cards">
                    <div class="price-card">
                        <div class="price-header">
                            <h3 class="price-plan">Starter</h3>
                            <div class="price-amount">
                                <span class="price-currency">â‚¹</span>
                                <span class="price-value">99</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="price-original">â‚¹499</div>
                        </div>
                        <ul class="price-features">
                            <li><i class="fas fa-check"></i> Personal TTS Bot</li>
                            <li><i class="fas fa-check"></i> 20 Hours Weekly</li>
                            <li><i class="fas fa-check"></i> All 4 Voices</li>
                            <li><i class="fas fa-check"></i> Email Support</li>
                        </ul>
                        <button class="btn btn-upgrade" onclick="purchasePlan('starter')">
                            Get Started
                        </button>
                    </div>

                    <div class="price-card popular">
                        <div class="popular-badge">MOST POPULAR</div>
                        <div class="price-header">
                            <h3 class="price-plan">Professional</h3>
                            <div class="price-amount">
                                <span class="price-currency">â‚¹</span>
                                <span class="price-value">249</span>
                                <span class="price-period">/month</span>
                            </div>
                            <div class="price-original">â‚¹1499</div>
                        </div>
                        <ul class="price-features">
                            <li><i class="fas fa-check"></i> Everything in Starter</li>
                            <li><i class="fas fa-check"></i> Priority Processing</li>
                            <li><i class="fas fa-check"></i> API Access</li>
                            <li><i class="fas fa-check"></i> 24/7 Support</li>
                        </ul>
                        <button class="btn btn-upgrade" onclick="purchasePlan('professional')">
                            Get Professional
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Waiting Section -->
        <div class="waiting-section" id="waitingSection">
            <div class="waiting-card">
                <div class="waiting-icon">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <h2 class="waiting-title">Bot Assignment Pending</h2>
                <p class="waiting-desc">
                    Thank you for your purchase! Your personal TTS bot will be assigned within 24 hours. 
                    You'll receive an email notification once it's ready.
                </p>

                <div class="countdown-timer">
                    <div class="countdown-label">Time remaining</div>
                    <div class="countdown-display">
                        <div class="countdown-item">
                            <div class="countdown-value" id="countHours">23</div>
                            <div class="countdown-unit">Hours</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" id="countMinutes">59</div>
                            <div class="countdown-unit">Minutes</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value" id="countSeconds">59</div>
                            <div class="countdown-unit">Seconds</div>
                        </div>
                    </div>
                </div>

                <div class="email-verify-form" id="emailVerifyForm">
                    <input 
                        type="email" 
                        class="email-verify-input" 
                        placeholder="Enter your authorized email"
                        id="authorizedEmail"
                    >
                    <button class="btn btn-primary" onclick="checkAuthorization()">
                        Verify Access
                    </button>
                </div>

                <button class="btn btn-secondary mt-2" onclick="showPage('info')">
                    Back to Home
                </button>
            </div>
        </div>

        <!-- TTS Page -->
        <div class="tts-page" id="ttsPage">
            <div class="tts-header">
                <h1 class="tts-title">Create Your Audio</h1>
                <p class="tts-subtitle">Select a voice and upload your text file to get started</p>
            </div>

            <!-- Voice Selection -->
            <section class="voice-section">
                <h2 class="section-title">
                    <i class="fas fa-microphone"></i>
                    Select Voice
                </h2>
                <div class="voice-grid">
                    <div class="voice-card" onclick="selectVoice('voice1')" id="voice1">
                        <div class="voice-radio"></div>
                        <div class="voice-avatar">ðŸ‘¨â€ðŸ’¼</div>
                        <h3 class="voice-name">Professional Male</h3>
                        <p class="voice-desc">Clear and confident business voice</p>
                        <button class="voice-demo-btn" onclick="playDemo(event, 'voice1')">
                            <i class="fas fa-play"></i> Play Demo
                        </button>
                    </div>

                    <div class="voice-card" onclick="selectVoice('voice2')" id="voice2">
                        <div class="voice-radio"></div>
                        <div class="voice-avatar">ðŸ‘©</div>
                        <h3 class="voice-name">Friendly Female</h3>
                        <p class="voice-desc">Warm and engaging narrative voice</p>
                        <button class="voice-demo-btn" onclick="playDemo(event, 'voice2')">
                            <i class="fas fa-play"></i> Play Demo
                        </button>
                    </div>

                    <div class="voice-card" onclick="selectVoice('voice3')" id="voice3">
                        <div class="voice-radio"></div>
                        <div class="voice-avatar">ðŸ“°</div>
                        <h3 class="voice-name">News Anchor</h3>
                        <p class="voice-desc">Authoritative news reading voice</p>
                        <button class="voice-demo-btn" onclick="playDemo(event, 'voice3')">
                            <i class="fas fa-play"></i> Play Demo
                        </button>
                    </div>

                    <div class="voice-card" onclick="selectVoice('voice4')" id="voice4">
                        <div class="voice-radio"></div>
                        <div class="voice-avatar">ðŸ“–</div>
                        <h3 class="voice-name">Storyteller</h3>
                        <p class="voice-desc">Expressive audiobook narration</p>
                        <button class="voice-demo-btn" onclick="playDemo(event, 'voice4')">
                            <i class="fas fa-play"></i> Play Demo
                        </button>
                    </div>
                </div>
            </section>

            <!-- Upload Section -->
            <section class="upload-section">
                <h2 class="section-title">
                    <i class="fas fa-file-upload"></i>
                    Upload Text File
                </h2>
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="upload-text">Drag & drop your .txt file here or click to browse</p>
                    <button class="btn btn-primary">
                        <i class="fas fa-folder-open"></i>
                        Choose File
                    </button>
                    <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileSelect(event)">
                </div>
                
                <div class="file-info" id="fileInfo">
                    <div class="file-details">
                        <div class="file-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div>
                            <div class="file-name" id="fileName">document.txt</div>
                            <div class="file-size" id="fileSize">2.4 MB</div>
                        </div>
                    </div>
                    <button class="remove-file-btn" onclick="removeFile()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="char-info" id="charInfo">
                    <div class="char-count">
                        Characters: <strong id="charCount">0</strong> / 200,000
                    </div>
                    <div class="char-limit">
                        Monthly limit: 5,000,000 characters
                    </div>
                </div>
                <div class="char-warning" id="charWarning">
                    âš ï¸ File exceeds maximum character limit of 200,000 characters
                </div>
            </section>

            <!-- Generate Button -->
            <section class="generate-section">
                <p class="generate-info">
                    Your audio will be processed by your personal TTS bot and delivered within 6-12 hours
                </p>
                <button class="btn btn-generate" id="generateBtn" disabled onclick="generateAudio()">
                    <i class="fas fa-magic"></i>
                    Generate Audio
                </button>
            </section>

            <!-- Processing Section -->
            <section class="processing-section" id="processingSection">
                <div class="processing-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <h2 class="processing-title">Processing Your Audio</h2>
                <p class="processing-desc">Your file is being converted to natural speech</p>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>

                <div class="status-list">
                    <div class="status-item active" id="status1">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Uploading file to cloud...</span>
                    </div>
                    <div class="status-item" id="status2">
                        <i class="fas fa-circle"></i>
                        <span>Sending to your TTS bot...</span>
                    </div>
                    <div class="status-item" id="status3">
                        <i class="fas fa-circle"></i>
                        <span>AI processing in progress...</span>
                    </div>
                    <div class="status-item" id="status4">
                        <i class="fas fa-circle"></i>
                        <span>Finalizing audio file...</span>
                    </div>
                </div>
            </section>

            <!-- Download Section -->
            <section class="download-section" id="downloadSection">
                <div class="download-icon">
                    <i class="fas fa-check"></i>
                </div>
                <h2 class="download-title">Audio Ready!</h2>
                <p class="download-desc">Your audio has been successfully generated</p>

                <div class="download-info">
                    <div class="download-row">
                        <span class="download-label">File Name:</span>
                        <span class="download-value" id="downloadFileName">audio_output.mp3</span>
                    </div>
                    <div class="download-row">
                        <span class="download-label">Voice:</span>
                        <span class="download-value" id="downloadVoice">Professional Male</span>
                    </div>
                    <div class="download-row">
                        <span class="download-label">Duration:</span>
                        <span class="download-value" id="downloadDuration">12:34</span>
                    </div>
                    <div class="download-row">
                        <span class="download-label">File Size:</span>
                        <span class="download-value" id="downloadSize">15.2 MB</span>
                    </div>
                </div>

                <button class="btn btn-download" onclick="downloadAudio()">
                    <i class="fas fa-download"></i>
                    Download Audio
                </button>

                <button class="btn btn-secondary" onclick="createNewAudio()">
                    <i class="fas fa-plus"></i>
                    Create Another Audio
                </button>
            </section>
        </div>

        <!-- History Page -->
        <div class="history-page" id="historyPage">
            <div class="history-header">
                <h1 class="history-title">Audio History</h1>
                <p class="history-subtitle">View and download your previous conversions</p>
            </div>

            <div class="history-filters">
                <div class="filter-group">
                    <div class="filter-label">Status</div>
                    <select class="filter-select" onchange="filterHistory()">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="processing">Processing</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Voice</div>
                    <select class="filter-select" onchange="filterHistory()">
                        <option value="all">All Voices</option>
                        <option value="voice1">Professional Male</option>
                        <option value="voice2">Friendly Female</option>
                        <option value="voice3">News Anchor</option>
                        <option value="voice4">Storyteller</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Date Range</div>
                    <select class="filter-select" onchange="filterHistory()">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
            </div>

            <div class="history-list" id="historyList">
                <!-- History items will be dynamically added here -->
            </div>

            <div class="empty-state" id="emptyHistory" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="empty-title">No Audio History</h3>
                <p class="empty-desc">Start creating audio to see your history here</p>
                <button class="btn btn-primary" onclick="showPage('tts')">
                    <i class="fas fa-plus"></i>
                    Create Your First Audio
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase & App Scripts -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCmBZmN-BCa3Qkb7f7K9TjXuK1_ma1ukbw",
            authDomain: "bluefm-tts.firebaseapp.com",
            projectId: "bluefm-tts",
            storageBucket: "bluefm-tts.firebasestorage.app",
            messagingSenderId: "184060585228",
            appId: "1:184060585228:web:045fdd4e5d4429fc7e9529"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const functions = firebase.functions();

        // App State
        const appState = {
            currentUser: null,
            selectedVoice: null,
            uploadedFile: null,
            currentJobId: null,
            userPlan: 'free',
            hasBot: false,
            botData: null,
            jobListener: null
        };

        // Voice configurations
        const voices = {
            voice1: { name: 'Professional Male', ref: 'professional-male.mp3' },
            voice2: { name: 'Friendly Female', ref: 'friendly-female.mp3' },
            voice3: { name: 'News Anchor', ref: 'news-anchor.mp3' },
            voice4: { name: 'Storyteller', ref: 'storyteller.mp3' }
        };

        // Initialize app
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸš€ Initializing BlueFM TTS...');
            
            // Setup auth listener
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    console.log('ðŸ‘¤ User signed in:', user.email);
                    appState.currentUser = user;
                    await loadUserData();
                    showApp();
                } else {
                    console.log('ðŸšª No user signed in');
                    showAuth();
                }
            });

            // Setup event listeners
            setupEventListeners();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hide');
            }, 1000);
        });

        // Setup event listeners
        function setupEventListeners() {
            // File drag and drop
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileSelect({ target: { files } });
                    }
                });
            }

            // Close dropdowns on outside click
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.user-menu')) {
                    document.getElementById('userDropdown').classList.remove('show');
                }
            });
        }

        // Auth Functions
        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.currentTarget.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');

            // Validate
            if (!email || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }

            // Show loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';

            try {
                // Sign in with Firebase
                const result = await auth.signInWithEmailAndPassword(email, password);
                console.log('âœ… Login successful:', result.user.email);
                showToast('Login successful!', 'success');
            } catch (error) {
                console.error('âŒ Login error:', error);
                let message = 'Login failed. Please try again.';
                
                if (error.code === 'auth/user-not-found') {
                    message = 'No account found with this email.';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Incorrect password.';
                } else if (error.code === 'auth/invalid-email') {
                    message = 'Invalid email address.';
                }
                
                showToast(message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Sign In';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const btn = document.getElementById('registerBtn');

            // Validate
            if (!name || !email || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }

            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }

            // Show loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';

            try {
                // Create user with Firebase
                const result = await auth.createUserWithEmailAndPassword(email, password);
                
                // Update display name
                await result.user.updateProfile({
                    displayName: name
                });

                // Create user document in Firestore
                await db.collection('users').doc(result.user.uid).set({
                    name: name,
                    email: email,
                    plan: 'free',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    botAssigned: false,
                    monthlyUsage: {
                        characters: 0,
                        files: 0
                    }
                });

                console.log('âœ… Registration successful:', result.user.email);
                showToast('Account created successfully!', 'success');
            } catch (error) {
                console.error('âŒ Registration error:', error);
                let message = 'Registration failed. Please try again.';
                
                if (error.code === 'auth/email-already-in-use') {
                    message = 'Email already registered.';
                } else if (error.code === 'auth/invalid-email') {
                    message = 'Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    message = 'Password is too weak.';
                }
                
                showToast(message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Create Account';
            }
        }

        async function loginWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                
                // Check if new user
                if (result.additionalUserInfo.isNewUser) {
                    // Create user document
                    await db.collection('users').doc(result.user.uid).set({
                        name: result.user.displayName,
                        email: result.user.email,
                        plan: 'free',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        botAssigned: false,
                        monthlyUsage: {
                            characters: 0,
                            files: 0
                        }
                    });
                }
                
                console.log('âœ… Google login successful:', result.user.email);
                showToast('Login successful!', 'success');
            } catch (error) {
                console.error('âŒ Google login error:', error);
                showToast('Google login failed. Please try again.', 'error');
            }
        }

        // Load user data from Firestore
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(appState.currentUser.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    appState.userPlan = userData.plan || 'free';
                    appState.hasBot = userData.botAssigned || false;
                    appState.botData = userData.botData || null;
                    
                    // Update UI
                    updateUserInterface();
                    
                    // Check if waiting for bot
                    if (appState.userPlan !== 'free' && !appState.hasBot) {
                        checkBotAssignment();
                    }
                } else {
                    // Create user document if not exists
                    await db.collection('users').doc(appState.currentUser.uid).set({
                        name: appState.currentUser.displayName || 'User',
                        email: appState.currentUser.email,
                        plan: 'free',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        botAssigned: false,
                        monthlyUsage: {
                            characters: 0,
                            files: 0
                        }
                    });
                }
            } catch (error) {
                console.error('âŒ Error loading user data:', error);
            }
        }

        // Update user interface
        function updateUserInterface() {
            if (!appState.currentUser) return;

            // Update header
            const userEmail = document.getElementById('userEmail');
            const userPlan = document.getElementById('userPlan');
            const userAvatar = document.getElementById('userAvatar');

            if (userEmail) userEmail.textContent = appState.currentUser.email;
            if (userPlan) userPlan.textContent = appState.userPlan === 'free' ? 'Free Plan' : `${appState.userPlan} Plan`;
            if (userAvatar) userAvatar.textContent = appState.currentUser.email.charAt(0).toUpperCase();
        }

        // Show/Hide functions
        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Show appropriate page
            if (appState.userPlan !== 'free' && !appState.hasBot) {
                showPage('waiting');
                startCountdown();
            } else {
                showPage('info');
            }
            
            // Load history
            loadHistory();
        }

        function showPage(page) {
            // Hide all pages
            document.getElementById('infoPage').style.display = 'none';
            document.getElementById('waitingSection').style.display = 'none';
            document.getElementById('ttsPage').style.display = 'none';
            document.getElementById('historyPage').style.display = 'none';
            
            // Close mobile menu
            document.getElementById('mobileMenu').classList.remove('show');
            
            // Show requested page
            switch(page) {
                case 'info':
                    document.getElementById('infoPage').style.display = 'block';
                    break;
                case 'waiting':
                    document.getElementById('waitingSection').style.display = 'block';
                    break;
                case 'tts':
                    if (appState.userPlan === 'free') {
                        showToast('Please upgrade to premium to create audio', 'warning');
                        showPage('info');
                        return;
                    }
                    if (!appState.hasBot) {
                        showToast('Waiting for bot assignment', 'warning');
                        showPage('waiting');
                        return;
                    }
                    document.getElementById('ttsPage').style.display = 'block';
                    checkActiveJobs();
                    break;
                case 'history':
                    document.getElementById('historyPage').style.display = 'block';
                    loadHistory();
                    break;
                default:
                    showToast(`${page} page coming soon!`, 'warning');
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('show');
        }

        // User menu toggle
        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        // Logout
        async function logout() {
            try {
                await auth.signOut();
                appState.currentUser = null;
                appState.selectedVoice = null;
                appState.uploadedFile = null;
                appState.currentJobId = null;
                showToast('Logged out successfully', 'success');
            } catch (error) {
                console.error('âŒ Logout error:', error);
                showToast('Logout failed', 'error');
            }
        }

        // Purchase plan
        async function purchasePlan(plan) {
            if (!appState.currentUser) {
                showToast('Please login first', 'warning');
                return;
            }

            showToast('Processing payment...', 'warning');

            // Simulate payment (integrate real payment gateway here)
            setTimeout(async () => {
                try {
                    // Update user plan
                    await db.collection('users').doc(appState.currentUser.uid).update({
                        plan: plan,
                        planStartDate: firebase.firestore.FieldValue.serverTimestamp(),
                        botAssigned: false,
                        waitingForBot: true,
                        botRequestTime: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    appState.userPlan = plan;
                    updateUserInterface();
                    
                    showToast('Payment successful! Your bot will be assigned within 24 hours.', 'success');
                    showPage('waiting');
                    startCountdown();
                } catch (error) {
                    console.error('âŒ Plan update error:', error);
                    showToast('Payment failed. Please try again.', 'error');
                }
            }, 2000);
        }

        // Countdown timer
        function startCountdown() {
            const endTime = new Date().getTime() + (24 * 60 * 60 * 1000); // 24 hours from now
            
            const updateCountdown = () => {
                const now = new Date().getTime();
                const distance = endTime - now;
                
                if (distance < 0) {
                    document.getElementById('countHours').textContent = '00';
                    document.getElementById('countMinutes').textContent = '00';
                    document.getElementById('countSeconds').textContent = '00';
                    document.getElementById('emailVerifyForm').style.display = 'block';
                    return;
                }
                
                const hours = Math.floor(distance / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                document.getElementById('countHours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('countMinutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('countSeconds').textContent = seconds.toString().padStart(2, '0');
                
                setTimeout(updateCountdown, 1000);
            };
            
            updateCountdown();
        }

        // Check bot assignment
        async function checkBotAssignment() {
            try {
                const userDoc = await db.collection('users').doc(appState.currentUser.uid).get();
                const userData = userDoc.data();
                
                if (userData.botAssigned && userData.botData) {
                    appState.hasBot = true;
                    appState.botData = userData.botData;
                    showToast('Your TTS bot is ready!', 'success');
                    showPage('tts');
                }
            } catch (error) {
                console.error('âŒ Bot check error:', error);
            }
        }

        // Check authorization (manual email verification)
        async function checkAuthorization() {
            const email = document.getElementById('authorizedEmail').value;
            
            if (!email) {
                showToast('Please enter your authorized email', 'error');
                return;
            }

            if (email.toLowerCase() !== appState.currentUser.email.toLowerCase()) {
                showToast('Email does not match your account', 'error');
                return;
            }

            // Call Firebase function to check bot assignment
            try {
                const checkBot = functions.httpsCallable('authenticateUser');
                const result = await checkBot({ email: email });
                
                if (result.data.success && result.data.assignedBot) {
                    // Update local data
                    await db.collection('users').doc(appState.currentUser.uid).update({
                        botAssigned: true,
                        botData: result.data.assignedBot
                    });
                    
                    appState.hasBot = true;
                    appState.botData = result.data.assignedBot;
                    
                    showToast('Bot access verified! Redirecting...', 'success');
                    setTimeout(() => {
                        showPage('tts');
                    }, 1500);
                } else {
                    showToast('Bot not assigned yet. Please wait.', 'warning');
                }
            } catch (error) {
                console.error('âŒ Authorization check error:', error);
                showToast('Verification failed. Please try again later.', 'error');
            }
        }

        // Voice selection
        function selectVoice(voiceId) {
            // Remove previous selection
            document.querySelectorAll('.voice-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection
            document.getElementById(voiceId).classList.add('selected');
            appState.selectedVoice = voiceId;
            
            updateGenerateButton();
            showToast(`Selected: ${voices[voiceId].name}`, 'success');
        }

        // Play voice demo
        function playDemo(event, voiceId) {
            event.stopPropagation();
            showToast('Voice demo will be available soon!', 'warning');
        }

        // File handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (!file.name.endsWith('.txt')) {
                showToast('Please upload a .txt file only', 'error');
                return;
            }
            
            // Check file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('File size must be less than 10MB', 'error');
                return;
            }
            
            appState.uploadedFile = file;
            
            // Show file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').classList.add('show');
            
            // Read file to count characters
            const reader = new FileReader();
            reader.onload = (e) => {
                const text = e.target.result;
                const charCount = text.length;
                
                document.getElementById('charCount').textContent = charCount.toLocaleString();
                document.getElementById('charInfo').classList.add('show');
                
                if (charCount > 200000) {
                    document.getElementById('charWarning').classList.add('show');
                    appState.uploadedFile = null;
                    updateGenerateButton();
                } else {
                    document.getElementById('charWarning').classList.remove('show');
                    updateGenerateButton();
                }
            };
            reader.readAsText(file);
        }

        function removeFile() {
            appState.uploadedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').classList.remove('show');
            document.getElementById('charInfo').classList.remove('show');
            document.getElementById('charWarning').classList.remove('show');
            updateGenerateButton();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function updateGenerateButton() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = !appState.selectedVoice || !appState.uploadedFile;
        }

        // Generate audio
        async function generateAudio() {
            if (!appState.selectedVoice || !appState.uploadedFile) {
                showToast('Please select a voice and upload a file', 'error');
                return;
            }

            try {
                const jobId = Date.now().toString();
                appState.currentJobId = jobId;
                
                // Show processing section
                document.getElementById('generateSection').style.display = 'none';
                document.getElementById('processingSection').style.display = 'block';
                
                // Update status
                updateProcessingStatus(1);
                
                // Upload file to Firebase Storage
                const fileName = `${jobId}-${appState.uploadedFile.name}`;
                const storageRef = storage.ref(`tts-requests/${appState.currentUser.uid}/${fileName}`);
                
                // Add metadata
                const metadata = {
                    customMetadata: {
                        userId: appState.currentUser.uid,
                        userEmail: appState.currentUser.email,
                        voiceId: appState.selectedVoice,
                        voiceName: voices[appState.selectedVoice].name,
                        referenceAudio: voices[appState.selectedVoice].ref,
                        jobId: jobId,
                        botToken: appState.botData.botToken,
                        botUsername: appState.botData.botUsername
                    }
                };
                
                // Upload file
                const uploadTask = await storageRef.put(appState.uploadedFile, metadata);
                console.log('âœ… File uploaded successfully');
                
                updateProcessingStatus(2);
                
                // Create job document
                await db.collection('tts_jobs').doc(jobId).set({
                    userId: appState.currentUser.uid,
                    userEmail: appState.currentUser.email,
                    fileName: appState.uploadedFile.name,
                    voiceId: appState.selectedVoice,
                    voiceName: voices[appState.selectedVoice].name,
                    status: 'processing',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Monitor job status
                monitorJob(jobId);
                
                showToast('Audio generation started!', 'success');
                
            } catch (error) {
                console.error('âŒ Generation error:', error);
                showToast('Failed to start audio generation', 'error');
                resetGeneration();
            }
        }

        // Update processing status
        function updateProcessingStatus(step) {
            const steps = ['status1', 'status2', 'status3', 'status4'];
            const progress = (step / steps.length) * 100;
            
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            steps.forEach((id, index) => {
                const element = document.getElementById(id);
                const icon = element.querySelector('i');
                
                if (index < step - 1) {
                    element.classList.remove('active');
                    element.classList.add('completed');
                    icon.className = 'fas fa-check-circle';
                } else if (index === step - 1) {
                    element.classList.add('active');
                    icon.className = 'fas fa-spinner fa-spin';
                } else {
                    element.classList.remove('active', 'completed');
                    icon.className = 'fas fa-circle';
                }
            });
        }

        // Monitor job status
        function monitorJob(jobId) {
            if (appState.jobListener) {
                appState.jobListener();
            }
            
            const jobRef = db.collection('tts_jobs').doc(jobId);
            
            appState.jobListener = jobRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    console.log('ðŸ“Š Job status:', data.status);
                    
                    switch(data.status) {
                        case 'processing':
                            updateProcessingStatus(3);
                            break;
                        case 'uploading':
                            updateProcessingStatus(4);
                            break;
                        case 'completed':
                            if (data.downloadUrl) {
                                showDownloadSection(data);
                            }
                            if (appState.jobListener) {
                                appState.jobListener();
                                appState.jobListener = null;
                            }
                            break;
                        case 'failed':
                            showToast('Audio generation failed: ' + (data.error || 'Unknown error'), 'error');
                            resetGeneration();
                            if (appState.jobListener) {
                                appState.jobListener();
                                appState.jobListener = null;
                            }
                            break;
                    }
                }
            });
        }

        // Check for active jobs
        async function checkActiveJobs() {
            try {
                const jobsQuery = await db.collection('tts_jobs')
                    .where('userId', '==', appState.currentUser.uid)
                    .where('status', 'in', ['processing', 'uploading'])
                    .orderBy('createdAt', 'desc')
                    .limit(1)
                    .get();
                
                if (!jobsQuery.empty) {
                    const job = jobsQuery.docs[0];
                    appState.currentJobId = job.id;
                    
                    // Show processing section
                    document.getElementById('generateSection').style.display = 'none';
                    document.getElementById('processingSection').style.display = 'block';
                    
                    // Monitor this job
                    monitorJob(job.id);
                }
            } catch (error) {
                console.error('âŒ Error checking active jobs:', error);
            }
        }

        // Show download section
        function showDownloadSection(jobData) {
            updateProcessingStatus(4);
            
            setTimeout(() => {
                document.getElementById('processingSection').style.display = 'none';
                document.getElementById('downloadSection').style.display = 'block';
                
                document.getElementById('downloadFileName').textContent = jobData.fileName.replace('.txt', '.mp3');
                document.getElementById('downloadVoice').textContent = jobData.voiceName;
                
                showToast('Audio generation completed!', 'success');
            }, 1500);
        }

        // Download audio
        function downloadAudio() {
            if (appState.currentJobId) {
                // Get download URL from job document
                db.collection('tts_jobs').doc(appState.currentJobId).get()
                    .then(doc => {
                        if (doc.exists && doc.data().downloadUrl) {
                            window.open(doc.data().downloadUrl, '_blank');
                            showToast('Download started!', 'success');
                        } else {
                            showToast('Download URL not available', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('âŒ Download error:', error);
                        showToast('Download failed', 'error');
                    });
            }
        }

        // Create new audio
        function createNewAudio() {
            resetGeneration();
            document.getElementById('downloadSection').style.display = 'none';
            document.getElementById('generateSection').style.display = 'block';
        }

        // Reset generation
        function resetGeneration() {
            appState.selectedVoice = null;
            appState.uploadedFile = null;
            appState.currentJobId = null;
            
            if (appState.jobListener) {
                appState.jobListener();
                appState.jobListener = null;
            }
            
            document.querySelectorAll('.voice-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            removeFile();
            
            document.getElementById('processingSection').style.display = 'none';
            document.getElementById('downloadSection').style.display = 'none';
            document.getElementById('generateSection').style.display = 'block';
            
            updateGenerateButton();
        }

        // Load history
        async function loadHistory() {
            try {
                const historyQuery = await db.collection('tts_jobs')
                    .where('userId', '==', appState.currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const historyList = document.getElementById('historyList');
                const emptyState = document.getElementById('emptyHistory');
                
                if (historyQuery.empty) {
                    historyList.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                historyList.style.display = 'block';
                emptyState.style.display = 'none';
                historyList.innerHTML = '';
                
                historyQuery.forEach(doc => {
                    const data = doc.data();
                    const item = createHistoryItem(doc.id, data);
                    historyList.appendChild(item);
                });
                
            } catch (error) {
                console.error('âŒ Error loading history:', error);
                showToast('Failed to load history', 'error');
            }
        }

        // Create history item
        function createHistoryItem(id, data) {
            const item = document.createElement('div');
            item.className = 'history-item';
            
            const statusClass = data.status === 'completed' ? 'completed' : 
                               data.status === 'failed' ? 'failed' : 'processing';
            
            const statusIcon = data.status === 'completed' ? 'check-circle' : 
                              data.status === 'failed' ? 'times-circle' : 'spinner fa-spin';
            
            const date = data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString() : 'Unknown';
            
            item.innerHTML = `
                <div class="history-info">
                    <div class="history-filename">${data.fileName || 'Unknown file'}</div>
                    <div class="history-meta">
                        <span><i class="fas fa-microphone"></i> ${data.voiceName || 'Unknown voice'}</span>
                        <span><i class="fas fa-calendar"></i> ${date}</span>
                        <span class="history-status ${statusClass}">
                            <i class="fas fa-${statusIcon}"></i> ${data.status}
                        </span>
                    </div>
                </div>
                <div class="history-actions">
                    ${data.status === 'completed' && data.downloadUrl ? 
                      `<button class="history-btn" onclick="downloadHistoryItem('${id}')">
                          <i class="fas fa-download"></i> Download
                       </button>` : ''}
                    ${data.status === 'processing' ? 
                      `<button class="history-btn" onclick="viewJob('${id}')">
                          <i class="fas fa-eye"></i> View
                       </button>` : ''}
                </div>
            `;
            
            return item;
        }

        // Download history item
        function downloadHistoryItem(jobId) {
            db.collection('tts_jobs').doc(jobId).get()
                .then(doc => {
                    if (doc.exists && doc.data().downloadUrl) {
                        window.open(doc.data().downloadUrl, '_blank');
                        showToast('Download started!', 'success');
                    } else {
                        showToast('Download not available', 'error');
                    }
                })
                .catch(error => {
                    console.error('âŒ Download error:', error);
                    showToast('Download failed', 'error');
                });
        }

        // View job
        function viewJob(jobId) {
            appState.currentJobId = jobId;
            showPage('tts');
            
            // Show processing section
            document.getElementById('generateSection').style.display = 'none';
            document.getElementById('processingSection').style.display = 'block';
            
            // Monitor this job
            monitorJob(jobId);
        }

        // Filter history
        function filterHistory() {
            showToast('Filter feature coming soon!', 'warning');
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconMap = {
                success: 'check-circle',
                error: 'times-circle',
                warning: 'exclamation-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${iconMap[type]}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="closeToast(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Close toast
        function closeToast(button) {
            button.parentElement.remove();
        }

        console.log('âœ… BlueFM TTS App initialized successfully!');
    </script>
</body>
</html>
