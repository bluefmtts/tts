<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue FM TTS - AI Voice Platform</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #3b82f6;
            --accent: #60a5fa;
            --gold: #fbbf24;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #e0e0ff;
            --shadow: rgba(37, 99, 235, 0.3);
            --gradient-primary: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #3b82f6 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            background: var(--gradient-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Background Animation */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            overflow: hidden;
        }

        .sound-wave {
            position: absolute;
            width: 200%;
            height: 100px;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%2360a5fa" fill-opacity="0.3" d="M0,160L48,170.7C96,181,192,203,288,197.3C384,192,480,160,576,165.3C672,171,768,213,864,213.3C960,213,1056,171,1152,160C1248,149,1344,171,1392,181.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            animation: wave 20s linear infinite;
        }

        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .particle {
            position: absolute;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.4; }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 101;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .connection-status.connecting {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .connection-status.waiting {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .connected .status-dot { background: var(--success); }
        .disconnected .status-dot { background: var(--error); }
        .connecting .status-dot, .waiting .status-dot { background: var(--warning); }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            color: var(--accent);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px var(--accent); }
            to { text-shadow: 0 0 20px var(--accent), 0 0 30px var(--accent); }
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }

        .nav-link:hover {
            color: var(--accent);
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-link.premium {
            background: linear-gradient(45deg, var(--gold), #f59e0b);
            color: #1f2937;
            font-weight: 600;
        }

        .nav-link.admin {
            background: linear-gradient(45deg, var(--error), #dc2626);
            color: white;
            font-weight: 600;
        }

        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .user-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 0.5rem;
            min-width: 200px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .user-dropdown.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Section */
        .login-section {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .login-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px var(--shadow);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--text-primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .google-login-btn {
            width: 100%;
            padding: 1rem;
            background: white;
            color: #333;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .google-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Glass Container */
        .glass-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px var(--shadow);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .glass-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px var(--shadow);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 6rem 1rem 2rem;
        }

        /* Hero Section */
        .hero-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--text-primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGlow 3s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            from { filter: drop-shadow(0 0 10px var(--accent)); }
            to { filter: drop-shadow(0 0 20px var(--accent)); }
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease-out 0.5s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: transform 0.6s;
        }

        .stat-card:hover::before {
            transform: rotate(45deg) translate(50px, 50px);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Audio Cards */
        .section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .audio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .audio-card {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            opacity: 1;
        }

        .audio-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .audio-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .audio-card:hover::before {
            left: 100%;
        }

        .audio-card:hover {
            transform: translateY(-8px);
        }

        .audio-card.selected {
            box-shadow: 0 0 30px var(--accent);
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .audio-card-content {
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .voice-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            animation: avatarGlow 3s ease-in-out infinite alternate;
        }

        @keyframes avatarGlow {
            from { box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
            to { box-shadow: 0 0 30px rgba(96, 165, 250, 0.6); }
        }

        .voice-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .voice-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .play-btn {
            background: var(--primary);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .audio-wave {
            flex: 1;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .audio-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            border-radius: 20px;
            transition: width 0.3s ease;
        }

        .radio-select {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 24px;
            height: 24px;
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-card.selected .radio-select {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent);
        }

        .audio-card.selected .radio-select::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        /* Status Message */
        .status-message {
            text-align: center;
            padding: 3rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .status-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
        }

        .status-icon.waiting {
            color: var(--warning);
            animation: pulse 2s infinite;
        }

        .status-icon.approved {
            color: var(--primary);
        }

        .status-icon.error {
            color: var(--error);
        }

        .status-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .status-description {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .status-details {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .countdown {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
            margin: 1rem 0;
        }

        /* Upload Section */
        .upload-section {
            margin-bottom: 3rem;
        }

        .upload-area {
            border: 2px dashed var(--glass-border);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            background: rgba(255, 255, 255, 0.02);
            opacity: 1;
        }

        .upload-area.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(96, 165, 250, 0.1);
            transform: translateY(-2px);
        }

        .upload-area.drag-over {
            border-color: var(--accent);
            background: rgba(96, 165, 250, 0.2);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 1rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--shadow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success), #059669);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--error), #dc2626);
            color: white;
        }

        /* File Info */
        .file-info {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 10px;
            border: 1px solid var(--success);
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        .file-info.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Character Counter */
        .character-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
        }

        .char-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .char-limit {
            font-size: 0.9rem;
            color: var(--accent);
        }

        /* Generate Section */
        .generate-section {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(45deg, rgba(37, 99, 235, 0.1), rgba(96, 165, 250, 0.1));
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid var(--glass-border);
        }

        .generate-btn {
            font-size: 1.25rem;
            padding: 1rem 3rem;
            position: relative;
        }

        .generate-btn:disabled {
            background: linear-gradient(45deg, #666, #888);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            display: none;
            animation: slideUp 0.3s ease-out;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            border-color: var(--success);
            color: var(--success);
        }

        .toast.error {
            border-color: var(--error);
            color: var(--error);
        }

        .toast.warning {
            border-color: var(--warning);
            color: var(--warning);
        }

        /* Admin Panel Styles */
        .admin-panel {
            display: none;
        }

        .admin-panel.show {
            display: block;
        }

        .tab-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-radius: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .user-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .user-table th,
        .user-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
        }

        .user-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: var(--accent);
        }

        .user-table tr:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-bot-linked {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .nav-links {
                gap: 0.5rem;
            }

            .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }

            .audio-grid {
                grid-template-columns: 1fr;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .connection-status {
                top: 60px;
                right: 10px;
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
            }

            .glass-container {
                padding: 1.5rem;
            }

            .main-content {
                padding: 5rem 1rem 2rem;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
                padding: 0.5rem 0;
            }

            .hero-title {
                font-size: 1.5rem;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 8rem 0.5rem 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="sound-wave"></div>
        <div class="floating-particles" id="particles"></div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status connecting" id="connectionStatus">
        <div class="status-dot"></div>
        <span>Connecting...</span>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="#" class="logo">
                <i class="fas fa-microphone-alt"></i>
                Blue FM TTS
            </a>
            <div class="nav-links" id="navLinks">
                <!-- Dynamic navigation based on user type -->
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <div class="login-section" id="loginSection">
        <div class="login-container">
            <h1 class="login-title">
                <i class="fas fa-microphone-alt" style="margin-right: 0.5rem;"></i>
                Blue FM TTS
            </h1>
            <p class="login-subtitle">Sign in with your Google account to access AI voice generation</p>
            
            <button class="google-login-btn" onclick="signInWithGoogle()">
                <i class="fab fa-google" style="color: #4285f4;"></i>
                Sign in with Google
            </button>
            
            <div style="margin-top: 2rem; font-size: 0.9rem; color: var(--text-secondary);">
                <p>✨ Free Plan: 5,000 characters/month</p>
                <p>🚀 Admin access for approved emails</p>
                <p>⏰ 24-hour approval process</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent" style="display: none;">
        <!-- Content will be dynamically loaded based on user status -->
    </main>

    <!-- Admin Panel -->
    <section class="admin-panel glass-container" id="adminPanel">
        <h2 class="section-title">
            <i class="fas fa-shield-alt" style="margin-right: 0.5rem; color: var(--error);"></i>
            Admin Panel
        </h2>
        
        <!-- Admin Stats -->
        <div class="stats-container" id="adminStats">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">-</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingUsers">-</div>
                <div class="stat-label">Pending Approval</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedUsers">-</div>
                <div class="stat-label">Approved Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="botsLinked">-</div>
                <div class="stat-label">Bots Linked</div>
            </div>
        </div>

        <!-- Admin Tabs -->
        <div class="tab-container">
            <button class="tab-btn active" onclick="switchAdminTab('pending')">
                <i class="fas fa-clock"></i> Pending Users
            </button>
            <button class="tab-btn" onclick="switchAdminTab('approved')">
                <i class="fas fa-check-circle"></i> Approved Users
            </button>
            <button class="tab-btn" onclick="switchAdminTab('all')">
                <i class="fas fa-users"></i> All Users
            </button>
        </div>

        <!-- Tab Contents -->
        <div class="tab-content active" id="pending-tab">
            <div class="loading" id="pendingLoading">
                <div class="spinner"></div>
                <p>Loading pending users...</p>
            </div>
            <div id="pendingUsersContainer"></div>
        </div>

        <div class="tab-content" id="approved-tab">
            <div class="loading" id="approvedLoading">
                <div class="spinner"></div>
                <p>Loading approved users...</p>
            </div>
            <div id="approvedUsersContainer"></div>
        </div>

        <div class="tab-content" id="all-tab">
            <div class="loading" id="allLoading">
                <div class="spinner"></div>
                <p>Loading all users...</p>
            </div>
            <div id="allUsersContainer"></div>
        </div>
    </section>

    <!-- Approve User Modal -->
    <div class="modal" id="approveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-user-plus" style="color: var(--success); margin-right: 0.5rem;"></i>
                    Approve User & Link Bot
                </h3>
                <button class="modal-close" onclick="closeApproveModal()">×</button>
            </div>
            <form id="approveForm">
                <input type="hidden" id="approveUserId">
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>
                        User Email:
                    </label>
                    <input type="text" id="approveUserEmail" class="form-input" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-key" style="margin-right: 0.5rem;"></i>
                        Bot Token:
                    </label>
                    <input type="text" id="botToken" class="form-input" 
                           placeholder="5555555555:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" required>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        Get this from @BotFather on Telegram
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-at" style="margin-right: 0.5rem;"></i>
                        Bot Username:
                    </label>
                    <input type="text" id="botUsername" class="form-input" 
                           placeholder="my_tts_bot" required>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        Without @ symbol
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-link" style="margin-right: 0.5rem;"></i>
                        Webhook URL:
                    </label>
                    <input type="url" id="webhookUrl" class="form-input" 
                           placeholder="https://your-bot.herokuapp.com/webhook" required>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        Your Python bot's webhook endpoint
                    </small>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;" id="approveSubmitBtn">
                        <i class="fas fa-check"></i> Approve & Link Bot
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeApproveModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        import { getFirestore, doc, onSnapshot, collection, query, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCmBZmN-BCa3Qkb7f7K9TjXuK1_ma1ukbw",
            authDomain: "bluefm-tts.firebaseapp.com",
            projectId: "bluefm-tts",
            storageBucket: "bluefm-tts.firebasestorage.app",
            messagingSenderId: "184060585228",
            appId: "1:184060585228:web:045fdd4e5d4429fc7e9529",
            measurementId: "G-ZTZNZG8YSJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const db = getFirestore(app);
        const functions = getFunctions(app);

        // Firebase Functions
        const createUserAccount = httpsCallable(functions, 'createUserAccount');
        const checkUserStatus = httpsCallable(functions, 'checkUserStatus');
        const getUserAudioFiles = httpsCallable(functions, 'getUserAudioFiles');
        const getAudioUrl = httpsCallable(functions, 'getAudioUrl');
        const testFunction = httpsCallable(functions, 'testFunction');
        
        // Admin Functions
        const getPendingUsers = httpsCallable(functions, 'getPendingUsers');
        const getAllUsers = httpsCallable(functions, 'getAllUsers');
        const approveUserWithBot = httpsCallable(functions, 'approveUserWithBot');
        const deleteUser = httpsCallable(functions, 'deleteUser');

        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let selectedVoice = null;
        let uploadedFile = null;
        let currentJobId = null;
        let currentDownloadUrl = null;
        let allUsers = [];
        let adminStats = { total: 0, pending: 0, approved: 0, botsLinked: 0 };

        // Admin emails
        const adminEmails = [
            'admin@bluefm.com',
            'singhvikas21571@gmail.com', // Your email
            'admin@admin.com'
        ];

        // Voice names mapping
        const voiceNames = {
            'voice1': 'Professional Male',
            'voice2': 'Friendly Female', 
            'voice3': 'News Anchor',
            'voice4': 'Storyteller'
        };

        // Voice to Reference Audio mapping
        const voiceToReference = {
            'voice1': 'professional-male.mp3',
            'voice2': 'friendly-female.mp3',
            'voice3': 'news-anchor.mp3',
            'voice4': 'storyteller.mp3'
        };

        // Demo audio URLs
        const demoAudioUrls = {
            'voice1': 'https://firebasestorage.googleapis.com/v0/b/bluefm-tts.firebasestorage.app/o/reference-voices%2Fprofessional-male.mp3?alt=media',
            'voice2': 'https://firebasestorage.googleapis.com/v0/b/bluefm-tts.firebasestorage.app/o/reference-voices%2Ffriendly-female.mp3?alt=media',
            'voice3': 'https://firebasestorage.googleapis.com/v0/b/bluefm-tts.firebasestorage.app/o/reference-voices%2Fnews-anchor.mp3?alt=media',
            'voice4': 'https://firebasestorage.googleapis.com/v0/b/bluefm-tts.firebasestorage.app/o/reference-voices%2Fstoryteller.mp3?alt=media'
        };

        // Initialize particles
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Update connection status
        function updateConnectionStatus(status, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status ${status}`;
            statusEl.querySelector('span').textContent = message;
        }

        // Google Sign In
        window.signInWithGoogle = async function() {
            try {
                updateConnectionStatus('connecting', 'Signing in...');
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                console.log('✅ User signed in:', result.user.email);
            } catch (error) {
                console.error('❌ Sign in error:', error);
                updateConnectionStatus('disconnected', 'Sign in failed');
                showToast('Sign in failed: ' + error.message, 'error');
            }
        }

        // Check authentication state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                isAdmin = adminEmails.includes(user.email);
                
                console.log('✅ User logged in:', user.email);
                console.log('🔑 Admin access:', isAdmin);
                
                // Hide login section, show main content
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Update navigation
                updateNavigation();
                
                // Create user account if not exists
                await ensureUserExists(user);
                
                // Check user status and setup interface
                await checkUserStatusAndSetup(user);
                
            } else {
                console.log('❌ User not logged in');
                updateConnectionStatus('disconnected', 'Not logged in');
                
                // Show login section, hide main content
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('mainContent').style.display = 'none';
            }
        });

        // Update navigation based on user type
        function updateNavigation() {
            const navLinks = document.getElementById('navLinks');
            
            if (isAdmin) {
                navLinks.innerHTML = `
                    <a href="#" class="nav-link" onclick="showUserInterface()">
                        <i class="fas fa-microphone"></i> TTS Tool
                    </a>
                    <a href="#" class="nav-link admin" onclick="showAdminPanel()">
                        <i class="fas fa-shield-alt"></i> Admin Panel
                    </a>
                    <div class="user-menu">
                        <button class="user-btn" onclick="toggleUserMenu()">
                            <i class="fas fa-crown" style="color: var(--gold);"></i>
                            <span id="userName">${currentUser.displayName || currentUser.email.split('@')[0]}</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--glass-border);">
                                <div style="font-weight: 600; color: var(--gold);">Admin Access</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Full platform control</div>
                            </div>
                            <button class="nav-link" style="display: block; width: 100%; text-align: left; padding: 0.75rem; background: none; border: none; cursor: pointer;" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                `;
            } else {
                navLinks.innerHTML = `
                    <div class="user-menu">
                        <button class="user-btn" onclick="toggleUserMenu()">
                            <i class="fas fa-user-circle"></i>
                            <span id="userName">${currentUser.displayName || currentUser.email.split('@')[0]}</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--glass-border);">
                                <div style="font-weight: 600;">Free Plan</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">5,000 chars/month</div>
                            </div>
                            <button class="nav-link" style="display: block; width: 100%; text-align: left; padding: 0.75rem; background: none; border: none; cursor: pointer;" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Ensure user exists in database
        async function ensureUserExists(user) {
            try {
                updateConnectionStatus('connecting', 'Setting up account...');
                
                // Check if user exists first
                const statusResult = await checkUserStatus({ userId: user.uid });
                const userStatus = statusResult.data;
                
                if (!userStatus.exists) {
                    // Create user account
                    console.log('🆕 Creating new user account...');
                    await createUserAccount({ 
                        email: user.email, 
                        uid: user.uid 
                    });
                    console.log('✅ User account created');
                }
                
            } catch (error) {
                console.error('❌ Error ensuring user exists:', error);
                // Don't throw error, just log it
            }
        }

        // Check user status and setup interface
        async function checkUserStatusAndSetup(user) {
            try {
                updateConnectionStatus('connecting', 'Checking account...');
                
                // For admin, show both interfaces
                if (isAdmin) {
                    updateConnectionStatus('connected', 'Admin connected');
                    showUserInterface(); // Show TTS interface by default
                    await loadAdminData(); // Load admin data in background
                    return;
                }
                
                // For regular users, check approval status
                const result = await checkUserStatus({ userId: user.uid });
                const status = result.data;
                
                console.log('📊 User Status:', status);
                
                if (!status.exists) {
                    showWaitingMessage('Account being created...');
                    return;
                }
                
                if (!status.isApproved) {
                    showWaitingMessage('Please wait 24 hours for admin approval', status.waitTimeRemaining);
                    return;
                }
                
                if (!status.canUseService) {
                    showBotNotLinkedMessage();
                    return;
                }
                
                // User is fully approved and can use service
                updateConnectionStatus('connected', 'Connected');
                showUserInterface();
                
            } catch (error) {
                console.error('❌ User status check error:', error);
                updateConnectionStatus('disconnected', 'Setup error');
                showToast('Error checking account status', 'error');
            }
        }

        // Show waiting message for regular users
        function showWaitingMessage(message, timeRemaining = null) {
            const mainContent = document.getElementById('mainContent');
            const adminPanel = document.getElementById('adminPanel');
            
            adminPanel.classList.remove('show');
            
            mainContent.innerHTML = `
                <div class="status-message">
                    <div class="status-icon waiting">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h2 class="status-title" style="color: var(--warning);">Account Under Review</h2>
                    <p class="status-description">
                        ${message}
                        <br>Your account will be activated once approved by our admin team.
                    </p>
                    ${timeRemaining ? `
                        <div class="status-details">
                            <div class="countdown">Time Remaining: ${formatTime(timeRemaining)}</div>
                            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                                Please be patient while we review your request.
                            </p>
                        </div>
                    ` : ''}
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 10px; margin-top: 2rem;">
                        <h4 style="color: var(--accent); margin-bottom: 1rem;">What happens next?</h4>
                        <div style="text-align: left; color: var(--text-secondary);">
                            <p style="margin-bottom: 0.5rem;">1. ⏰ Wait for admin approval (up to 24 hours)</p>
                            <p style="margin-bottom: 0.5rem;">2. 🤖 Admin will assign a personal TTS bot</p>
                            <p style="margin-bottom: 0.5rem;">3. ✅ You'll get access to voice generation</p>
                            <p>4. 🎉 Start creating amazing audio content!</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 2rem;">
                        <i class="fas fa-refresh"></i> Check Status Again
                    </button>
                </div>
            `;
            updateConnectionStatus('waiting', 'Waiting approval');
        }

        // Show bot not linked message
        function showBotNotLinkedMessage() {
            const mainContent = document.getElementById('mainContent');
            const adminPanel = document.getElementById('adminPanel');
            
            adminPanel.classList.remove('show');
            
            mainContent.innerHTML = `
                <div class="status-message">
                    <div class="status-icon approved">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h2 class="status-title" style="color: var(--primary);">Account Approved!</h2>
                    <p class="status-description">
                        Great news! Your account has been approved.
                        <br>Our admin is currently setting up your personal TTS bot.
                    </p>
                    <div class="status-details">
                        <div style="display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                            <div class="spinner" style="width: 20px; height: 20px;"></div>
                            <span>Setting up your personal AI voice bot...</span>
                        </div>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">
                            This usually takes just a few minutes. Please refresh the page shortly.
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-refresh"></i> Refresh Page
                    </button>
                </div>
            `;
            updateConnectionStatus('connecting', 'Setting up bot');
        }

        // Show user TTS interface
        window.showUserInterface = function() {
            const mainContent = document.getElementById('mainContent');
            const adminPanel = document.getElementById('adminPanel');
            
            adminPanel.classList.remove('show');
            
            mainContent.innerHTML = `
                <!-- Hero Section -->
                <section class="hero-section">
                    <h1 class="hero-title">Transform Text to Natural Speech</h1>
                    <p class="hero-subtitle">Create professional voiceovers with AI-powered voices</p>
                </section>

                <!-- Stats Section -->
                <section class="stats-container">
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Natural Voices</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">20+</div>
                        <div class="stat-label">Languages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Users Joined</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">99.9%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </section>

                <!-- Voice Selection -->
                <section class="glass-container">
                    <h2 class="section-title">Choose Your Voice</h2>
                    <div class="audio-grid">
                        <!-- Voice cards will be populated here -->
                    </div>
                </section>

                <!-- Upload Section -->
                <section class="upload-section glass-container">
                    <h2 class="section-title">Upload Your Text</h2>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <p style="margin-bottom: 1rem;">Drag & drop your .txt file here or</p>
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-upload"></i> Browse Files
                        </button>
                        <input type="file" id="fileInput" style="display: none;" accept=".txt">
                        <div class="file-info" id="fileInfo">
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            <span id="fileName"></span>
                        </div>
                    </div>
                    <div class="character-info" id="charInfo" style="display: none;">
                        <span class="char-count">Characters: <span id="charCount">0</span></span>
                        <span class="char-limit">Monthly Limit: 5,000 (Free Plan)</span>
                    </div>
                </section>

                <!-- Generate Section -->
                <section class="generate-section" id="generateSection">
                    <h3 style="margin-bottom: 1rem;">Ready to Create Your Audio?</h3>
                    <button class="btn btn-primary generate-btn" id="generateBtn" disabled onclick="generateAudio()">
                        <i class="fas fa-magic"></i> Generate Audio
                    </button>
                </section>
            `;
            
            // Check if user can use the service
            if (currentUser && !isAdmin) {
                checkUserServiceAccess();
            } else {
                // Admin or service available - enable everything
                createVoiceCards();
                initializeFileUpload();
                updateConnectionStatus('connected', 'Ready');
            }
        }

        // Check if user can access the service
        async function checkUserServiceAccess() {
            try {
                const result = await checkUserStatus({ userId: currentUser.uid });
                const status = result.data;
                
                if (status.canUseService) {
                    // Enable voice selection and file upload
                    createVoiceCards();
                    initializeFileUpload();
                    updateConnectionStatus('connected', 'Ready');
                } else {
                    // Disable voice selection and file upload
                    createVoiceCards(true); // Pass true to disable
                    disableFileUpload();
                    updateConnectionStatus('waiting', 'Service disabled');
                    showToast('Service is disabled. Please wait for admin approval.', 'warning');
                }
            } catch (error) {
                console.error('❌ Error checking service access:', error);
                createVoiceCards(true);
                disableFileUpload();
                updateConnectionStatus('disconnected', 'Service check failed');
            }
        }

        // Create voice cards
        function createVoiceCards(disabled = false) {
            const audioGrid = document.querySelector('.audio-grid');
            if (!audioGrid) return;
            
            const voices = [
                { id: 'voice1', name: 'Professional Male', avatar: '👨', desc: 'Clear, confident business voice' },
                { id: 'voice2', name: 'Friendly Female', avatar: '👩', desc: 'Warm, engaging narrative voice' },
                { id: 'voice3', name: 'News Anchor', avatar: '🎙', desc: 'Authoritative news reading voice' },
                { id: 'voice4', name: 'Storyteller', avatar: '📚', desc: 'Expressive audiobook narration' }
            ];
            
            audioGrid.innerHTML = voices.map(voice => `
                <div class="audio-card glass-container ${disabled ? 'disabled' : ''}" onclick="${disabled ? '' : `selectVoice('${voice.id}')`}">
                    <div class="radio-select"></div>
                    <div class="audio-card-content">
                        <div class="voice-avatar">${voice.avatar}</div>
                        <h3 class="voice-name">${voice.name}</h3>
                        <p class="voice-description">${voice.desc}</p>
                        <div class="audio-controls">
                            <button class="play-btn" onclick="${disabled ? '' : `playDemo(event, '${voice.id}')`}" ${disabled ? 'disabled' : ''}>
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="audio-wave">
                                <div class="audio-progress"></div>
                            </div>
                        </div>
                    </div>
                    ${disabled ? '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 0.5rem 1rem; border-radius: 10px; font-size: 0.9rem;">Service Disabled</div>' : ''}
                </div>
            `).join('');
        }

        // Initialize file upload
        function initializeFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            if (fileInput && uploadArea) {
                fileInput.addEventListener('change', handleFileSelect);
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFile(files[0]);
                    }
                });
            }
        }

        // Disable file upload
        function disableFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.classList.add('disabled');
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; border-radius: 20px;';
                overlay.innerHTML = '<div><i class="fas fa-lock" style="margin-bottom: 0.5rem; font-size: 2rem;"></i><br>Upload Disabled<br><small>Wait for approval</small></div>';
                uploadArea.style.position = 'relative';
                uploadArea.appendChild(overlay);
            }
        }

        // Show admin panel
        window.showAdminPanel = async function() {
            const mainContent = document.getElementById('mainContent');
            const adminPanel = document.getElementById('adminPanel');
            
            mainContent.innerHTML = ''; // Clear main content
            adminPanel.classList.add('show');
            
            await loadAdminData();
        }

        // Load admin data
        async function loadAdminData() {
            try {
                showLoadingForTab('pending');
                updateConnectionStatus('connecting', 'Loading admin data...');
                
                await loadAllUsers();
                await loadPendingUsers();
                updateAdminStats();
                
                updateConnectionStatus('connected', 'Admin data loaded');
                
            } catch (error) {
                console.error('❌ Error loading admin data:', error);
                updateConnectionStatus('disconnected', 'Admin load error');
                showToast('Error loading admin data', 'error');
            }
        }

        // Load all users
        async function loadAllUsers() {
            try {
                const result = await getAllUsers({ limit: 100 });
                allUsers = result.data.users;
                console.log('✅ Loaded users:', allUsers.length);
            } catch (error) {
                console.error('❌ Error loading users:', error);
                throw error;
            }
        }

        // Load pending users
        async function loadPendingUsers() {
            try {
                const result = await getPendingUsers();
                const pendingUsers = result.data.pendingUsers;
                
                displayUsers(pendingUsers, 'pending');
                hideLoadingForTab('pending');
                
            } catch (error) {
                console.error('❌ Error loading pending users:', error);
                hideLoadingForTab('pending');
                showToast('Error loading pending users', 'error');
            }
        }

        // Update admin stats
        function updateAdminStats() {
            adminStats.total = allUsers.length;
            adminStats.pending = allUsers.filter(u => !u.isApproved).length;
            adminStats.approved = allUsers.filter(u => u.isApproved).length;
            adminStats.botsLinked = allUsers.filter(u => u.botLinked).length;

            document.getElementById('totalUsers').textContent = adminStats.total;
            document.getElementById('pendingUsers').textContent = adminStats.pending;
            document.getElementById('approvedUsers').textContent = adminStats.approved;
            document.getElementById('botsLinked').textContent = adminStats.botsLinked;
        }

        // Display users
        function displayUsers(users, containerId) {
            const container = document.getElementById(`${containerId}UsersContainer`);
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>No ${containerId} users found</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="user-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-user" style="margin-right: 0.5rem;"></i>User</th>
                            <th><i class="fas fa-info-circle" style="margin-right: 0.5rem;"></i>Status</th>
                            <th><i class="fas fa-calendar" style="margin-right: 0.5rem;"></i>Created</th>
                            <th><i class="fas fa-robot" style="margin-right: 0.5rem;"></i>Bot</th>
                            <th><i class="fas fa-cogs" style="margin-right: 0.5rem;"></i>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>
                                    <div>
                                        <strong>${user.email}</strong>
                                        <br>
                                        <small style="color: var(--text-secondary); font-family: monospace;">
                                            ${user.userId.substring(0, 8)}...
                                        </small>
                                    </div>
                                </td>
                                <td>
                                    ${getStatusBadge(user)}
                                </td>
                                <td>
                                    <div>
                                        ${formatDate(user.createdAt)}
                                        <br>
                                        <small style="color: var(--text-secondary);">
                                            ${getWaitingTime(user.createdAt)}
                                        </small>
                                    </div>
                                </td>
                                <td>
                                    ${user.botLinked ? 
                                        `<span class="status-badge status-bot-linked">
                                            <i class="fas fa-robot"></i> @${user.botUsername}
                                         </span>` :
                                        '<span style="color: var(--text-secondary);">Not linked</span>'
                                    }
                                </td>
                                <td>
                                    ${getActionButtons(user)}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }

        // Get status badge
        function getStatusBadge(user) {
            if (!user.isApproved) {
                return `<span class="status-badge status-pending">
                    <i class="fas fa-clock"></i> Pending
                </span>`;
            } else if (user.botLinked) {
                return `<span class="status-badge status-bot-linked">
                    <i class="fas fa-robot"></i> Bot Linked
                </span>`;
            } else {
                return `<span class="status-badge status-approved">
                    <i class="fas fa-check"></i> Approved
                </span>`;
            }
        }

        // Get action buttons
        function getActionButtons(user) {
            if (!user.isApproved) {
                return `
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success" onclick="openApproveModal('${user.userId}', '${user.email}')">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-danger" onclick="deleteUserConfirm('${user.userId}', '${user.email}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            } else {
                return `
                    <button class="btn btn-danger" onclick="deleteUserConfirm('${user.userId}', '${user.email}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                `;
            }
        }

        // Format date
        function formatDate(timestamp) {
            if (!timestamp) return 'Unknown';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return new Intl.DateTimeFormat('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }).format(date);
        }

        // Get waiting time
        function getWaitingTime(timestamp) {
            if (!timestamp) return '';
            const now = new Date();
            const created = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const diff = now - created;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days} day${days === 1 ? '' : 's'} ago`;
            } else if (hours > 0) {
                return `${hours} hour${hours === 1 ? '' : 's'} ago`;
            } else {
                return `${minutes} minute${minutes === 1 ? '' : 's'} ago`;
            }
        }

        // Format time
        function formatTime(milliseconds) {
            if (!milliseconds) return '';
            const hours = Math.floor(milliseconds / (1000 * 60 * 60));
            const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }

        // Admin tab switching
        window.switchAdminTab = function(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Load data based on tab
            if (tabName === 'approved') {
                const approvedUsers = allUsers.filter(u => u.isApproved);
                displayUsers(approvedUsers, 'approved');
            } else if (tabName === 'all') {
                displayUsers(allUsers, 'all');
            } else if (tabName === 'pending') {
                const pendingUsers = allUsers.filter(u => !u.isApproved);
                displayUsers(pendingUsers, 'pending');
            }
        }

        // Show/hide loading for tabs
        function showLoadingForTab(tab) {
            const loading = document.getElementById(`${tab}Loading`);
            if (loading) loading.classList.add('show');
        }

        function hideLoadingForTab(tab) {
            const loading = document.getElementById(`${tab}Loading`);
            if (loading) loading.classList.remove('show');
        }

        // Open approve modal
        window.openApproveModal = function(userId, email) {
            document.getElementById('approveUserId').value = userId;
            document.getElementById('approveUserEmail').value = email;
            document.getElementById('approveModal').classList.add('show');
        }

        // Close approve modal
        window.closeApproveModal = function() {
            document.getElementById('approveModal').classList.remove('show');
            document.getElementById('approveForm').reset();
        }

        // Handle approve form
        document.getElementById('approveForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('approveSubmitBtn');
            const originalText = submitBtn.innerHTML;
            
            const userId = document.getElementById('approveUserId').value;
            const botToken = document.getElementById('botToken').value;
            const botUsername = document.getElementById('botUsername').value.replace('@', '');
            const webhookUrl = document.getElementById('webhookUrl').value;
            
            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Approving...';
                
                showToast('Approving user and linking bot...', 'warning');
                updateConnectionStatus('connecting', 'Approving user...');
                
                await approveUserWithBot({
                    userId,
                    botToken,
                    botUsername,
                    webhookUrl
                });
                
                showToast('User approved and bot linked successfully!', 'success');
                updateConnectionStatus('connected', 'User approved');
                closeApproveModal();
                
                // Reload admin data
                await loadAdminData();
                
            } catch (error) {
                console.error('❌ Error approving user:', error);
                showToast('Error approving user: ' + error.message, 'error');
                updateConnectionStatus('disconnected', 'Approval failed');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Delete user confirmation
        window.deleteUserConfirm = function(userId, email) {
            if (confirm(`⚠️ DELETE USER CONFIRMATION\n\nUser: ${email}\nID: ${userId}\n\nThis will permanently delete:\n• User account\n• All their audio files\n• All their TTS jobs\n\n❌ This action CANNOT be undone!\n\nType 'DELETE' to confirm:`)) {
                const confirmation = prompt('Type "DELETE" to confirm:');
                if (confirmation === 'DELETE') {
                    deleteUserById(userId, email);
                } else {
                    showToast('Deletion cancelled', 'warning');
                }
            }
        }

        // Delete user
        async function deleteUserById(userId, email) {
            try {
                showToast('Deleting user and all data...', 'warning');
                updateConnectionStatus('connecting', 'Deleting user...');
                
                await deleteUser({ userId });
                
                showToast(`User ${email} deleted successfully!`, 'success');
                updateConnectionStatus('connected', 'User deleted');
                
                // Reload admin data
                await loadAdminData();
                
            } catch (error) {
                console.error('❌ Error deleting user:', error);
                showToast('Error deleting user: ' + error.message, 'error');
                updateConnectionStatus('disconnected', 'Deletion failed');
            }
        }

        // Voice selection (for TTS interface)
        window.selectVoice = function(voiceId) {
            document.querySelectorAll('.audio-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            selectedVoice = voiceId;
            checkGenerateButton();
            showToast(`Voice selected: ${voiceNames[voiceId]}!`);
        }

        // Play demo
        window.playDemo = function(event, voiceId) {
            event.stopPropagation();
            const btn = event.currentTarget;
            const icon = btn.querySelector('i');
            const progressBar = btn.parentElement.querySelector('.audio-progress');
            
            if (icon.classList.contains('fa-play')) {
                try {
                    const audio = new Audio(demoAudioUrls[voiceId]);
                    
                    icon.classList.remove('fa-play');
                    icon.classList.add('fa-pause');
                    
                    audio.play();
                    
                    audio.addEventListener('timeupdate', () => {
                        const progress = (audio.currentTime / audio.duration) * 100;
                        progressBar.style.width = progress + '%';
                    });
                    
                    audio.addEventListener('ended', () => {
                        icon.classList.remove('fa-pause');
                        icon.classList.add('fa-play');
                        progressBar.style.width = '0%';
                    });
                    
                    audio.addEventListener('error', () => {
                        icon.classList.remove('fa-pause');
                        icon.classList.add('fa-play');
                        progressBar.style.width = '0%';
                        showToast('Demo audio will be available soon!', 'warning');
                    });
                    
                } catch (error) {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 2;
                        progressBar.style.width = progress + '%';
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            icon.classList.remove('fa-pause');
                            icon.classList.add('fa-play');
                            progressBar.style.width = '0%';
                        }
                    }, 100);
                }
            }
        }

        // File handling
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.name.endsWith('.txt')) {
                showToast('Please upload a .txt file only!', 'error');
                return;
            }
            
            uploadedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileInfo').classList.add('show');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const charCount = text.length;
                document.getElementById('charCount').textContent = charCount.toLocaleString();
                document.getElementById('charInfo').style.display = 'flex';
                
                if (charCount > 5000) {
                    showToast('File exceeds free plan limit. Upgrade to Premium!', 'warning');
                }
            };
            reader.readAsText(file);
            
            checkGenerateButton();
            showToast('File uploaded successfully!');
        }

        // Check generate button
        function checkGenerateButton() {
            const btn = document.getElementById('generateBtn');
            if (btn && selectedVoice && uploadedFile && currentUser) {
                btn.disabled = false;
            } else if (btn) {
                btn.disabled = true;
            }
        }

        // Generate audio (placeholder - you can implement full TTS logic)
        window.generateAudio = async function() {
            if (!selectedVoice || !uploadedFile) {
                showToast('Please select a voice and upload a file!', 'error');
                return;
            }
            
            if (!currentUser) {
                showToast('Please login first!', 'error');
                return;
            }
            
            try {
                updateConnectionStatus('connecting', 'Starting...');
                
                const jobId = Date.now().toString();
                const userId = currentUser.uid;
                currentJobId = jobId;
                
                showToast('Audio generation started!', 'success');
                updateConnectionStatus('connected', 'Processing...');
                
                // Your existing audio generation logic here
                
            } catch (error) {
                console.error('❌ Upload error:', error);
                showToast('Upload failed! Please try again.', 'error');
                updateConnectionStatus('disconnected', 'Upload failed');
            }
        }

        // Toggle user menu
        window.toggleUserMenu = function() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Logout
        window.logout = async function() {
            try {
                await signOut(auth);
                updateConnectionStatus('disconnected', 'Logged out');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Error logging out', 'error');
            }
        }

        // Show toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        // Initialize particles on load
        initParticles();

        // Close modals and dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'approveModal') {
                    closeApproveModal();
                }
            }
            
            if (!e.target.closest('.user-menu')) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown) dropdown.classList.remove('show');
            }
        });

        console.log('🚀 Blue FM TTS Platform loaded');
        updateConnectionStatus('connecting', 'Loading...');
    </script>
</body>
</html>
